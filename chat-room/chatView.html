<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Messages</title>
  <link rel="stylesheet" href="chatView.css">
  <script type="module" src="chatRoom.js"></script>
  <script type="module" src="chatRoomFakeServer.js"></script>
  <iframe id="frame" src="../create-group/create-group.html"></iframe> 

</head>
<body>

<div class="canvas-wrap">
  <!-- LEFT NAV BAR -->
  <nav class="canvas-nav">
    <!-- Brand at top -->
    <div class="nav-brand">
      <h2>UMass</h2>
      <p>Amherst</p>
    </div>

    <ul class="nav-list">
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">Account</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">Dashboard</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">Courses</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">Groups</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">Calendar</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">Inbox</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">History</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">Studio</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">Help</span>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item">
          <div class="icon-box"></div>
          <span class="nav-text">StudyBuddy</span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- MAIN CONTENT (white space) -->
  <main class="canvas-main">
    <!-- Triangular layout container -->
    <div class="triangle-container">
      <!-- Top row: 2 circles -->
      <!-- Bottom row: 1 circle centered -->
      <div class="row bottom-row">
          <div class="sidebar">
            <div class="sidebar-header">Messages </div>
            <!--Fake data-->
            <div class="conversation-list">
              <div class="conversation" onclick="viewSwap(this)" id="Group19StudyGroup">
                <!--In actual implementation, "id" would be group_name which would be stored in a database-->
                <img src="https://via.placeholder.com/40" alt="Group 19">
                <div class="conversation-info">
                    <div class="conversation-name">Group 19 Study Group</div>
                    <div class="conversation-preview">Let's study!</div>
                </div>
              </div>
            </div>
            <script type="module" src="chatRoomFakeServer.js">
              //import {chatRoomFakeServer} from './chatRoomFakeServer.js';
            
            </script>
        <div>
          <button class="create">Create Group</button>
        </div>
      </div>
    </div>
  </main>
</div>

<div class="chat-view" id="chatView">
    Welcome to your messages!
</div>

<div class="chat-container" id="chatContainer">
  <div class="chat-header" id="chatHeader">
    Group 19
  </div>
  <div class="chat-messages" id="chatMessages">
  </div>

  <button class="menu-button" id="menu-button">â‹®</button>
    <div class="dropdown">
      <button id="members">Members</button>
      <button onclick="">Settings</button>
    </div>

    <div class="modal-overlay" id="modalOverlay">
      <div class="modal">
        <h3>Members</h3>
        <ul>       

        </ul>
        <button id="close_members">Close</button>
      </div>
    </div>

  <div class="chat-input">
    <input id="message" type="text" placeholder="Type a message...">
    <button id="send_bttn" onclick="handleSend('message')">Send</button>
  </div>
</div>

<div id="newContainer" style="display:none"></div>






<script src="chatRoom.js" type="module">

  /*let current_gc = "Group19StudyGroup";

  const menu = document.getElementById("menu-button");


  const viewMembersButton = document.getElementById("members");

  viewMembersButton.addEventListener("click", function(e) {
    let modal_over = document.getElementById("modalOverlay");
    let members = message_logs[current_gc + "fakeServer"].get_members()

    document.getElementById("modalOverlay").style.display = 'flex';
  })

  menu.addEventListener("click", function(e) {
    const dropdown = menu.nextElementSibling;

    document.querySelectorAll(".dropdown").forEach(item => {
      if (item !== dropdown) {
        item.style.display = 'none';
      }
    });

    dropdown.style.display = dropdown.style.display === 'block'? 'none': 'block'
  })


  document.addEventListener("click", function(e) {
    if (!e.target.closest('.menu-button')) {
      document.querySelectorAll('.dropdown').forEach(item => item.style.display = 'none')
    }
  });


  document.getElementById("members").addEventListener("click", function(e) {
    let members = document.createElement('div');
  })

  function viewSwap(group) {

    current_gc = group.id;
    document.getElementById("chatMessages").innerHTML = '';
    lastRender[current_gc + "fakeServer"] = 0;
    rendermsg(group)
  }


  function rendermsg(group) {

    let id = group.id;

    document.getElementById("chatView").style.display = "none";

    document.getElementById("chatContainer").style.display = "flex";

    document.getElementById("chatHeader").innerText = id;



    const log = message_logs[id + "fakeServer"]
    //log.get_msg(input_id);
    const messages = log.fetch();

    let lastR = lastRender[id + "fakeServer"];


    const container = document.getElementById("chatMessages");

    if (!messages) {
      return;
    }

    for (let i = lastR; i < messages.length; i++) {
      console.log(i);
      const msg = messages[i];
      const bubble = document.createElement('div');
      bubble.className = 'chat-bubble';
      bubble.innerHTML = `
        ${msg.text}
        <div class = "timestamp"> ${new Date(msg.created).toLocaleTimeString([], { hour: '2-digit', minute:'2-digit'})}</div>`
      container.prepend(bubble)
    }

    lastRender[id + "fakeServer"] = messages.length;
  }

  
  function handleSend(input_id) {
    let log = message_logs[current_gc + "fakeServer"]
    if (!log) {
      message_logs[current_gc + "fakeServer"] = new chatRoomFakeServer(current_gc);
      log = message_logs[current_gc + "fakeServer"]
    }

    log.get_msg(input_id);

    document.getElementById(input_id).value = ""
  
    rendermsg(document.getElementById(current_gc));
  }*/


  
</script>
<script type="module" src="/chat-room/createGC.js"></script>
</body>
</html>